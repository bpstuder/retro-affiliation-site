---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const consoles = await getCollection('consoles');

  return consoles.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { data } = entry;
const { Content } = await entry.render();
---

<Layout title={data.title}>
  <article class="console-page">
    <header class="console-header">
      <div class="console-main-info">
        <h2>{data.title}</h2>
        {data.tagline && <p class="console-tagline">{data.tagline}</p>}

        <div class="console-meta">
          <span class="console-pill accent">{data.brand} · {data.model}</span>
          {data.price_eur && (
            <span class="console-pill">{data.price_eur} €</span>
          )}
          {data.ideal_for && (
            <span class="console-pill">{data.ideal_for}</span>
          )}
        </div>
      </div>

      {data.image && (
        <div class="console-image">
          <div class="console-image-inner">
            <img src={data.image} alt={data.title} loading="lazy" />
          </div>
        </div>
      )}
    </header>

    <section class="console-specs">
      <div class="console-specs-header">
        <h3>Fiche technique</h3>
        <span>Résumé des specs principales</span>
      </div>
      <div class="specs-grid">
        {data.screen_size && (
          <div class="spec-item">
            <dt>Écran</dt>
            <dd>{data.screen_size} {data.screen_type}</dd>
          </div>
        )}
        {data.cpu && (
          <div class="spec-item">
            <dt>Processeur</dt>
            <dd>{data.cpu}</dd>
          </div>
        )}
        {data.ram && (
          <div class="spec-item">
            <dt>RAM</dt>
            <dd>{data.ram}</dd>
          </div>
        )}
        {data.storage && (
          <div class="spec-item">
            <dt>Stockage</dt>
            <dd>{data.storage}</dd>
          </div>
        )}
        {data.battery && (
          <div class="spec-item">
            <dt>Batterie</dt>
            <dd>{data.battery}</dd>
          </div>
        )}
        {data.os && (
          <div class="spec-item">
            <dt>Système</dt>
            <dd>{data.os}</dd>
          </div>
        )}
      </div>
    </section>

    <section class="console-body">
      <Content />
    </section>

    <section class="console-buy">
      <div class="console-buy-label">
        <strong>Où acheter cette console ?</strong>
      </div>
      <div class="console-buy-buttons">
        {data.amazon_url && (
          <a
            class="btn-cta"
            href={data.amazon_url}
            target="_blank"
            rel="noopener noreferrer"
          >
            Voir le prix sur Amazon
          </a>
        )}
        {data.aliexpress_url && (
          <a
            class="btn-cta secondary"
            href={data.aliexpress_url}
            target="_blank"
            rel="noopener noreferrer"
          >
            Voir sur AliExpress
          </a>
        )}
      </div>
    </section>
  </article>
</Layout>